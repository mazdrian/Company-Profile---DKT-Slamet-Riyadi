{% extends "base.html" %}

{% block title %}Jadwal Dokter - RST Slamet Riyadi{% endblock %}

{% block content %}
<div class="pt-32 pb-16 min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="w-96 h-96 object-contain">
    </div>
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <div class="text-center mb-12 reveal">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl">Jadwal Praktik Dokter</h2>
            <div class="w-20 h-1 bg-green-600 mx-auto mt-6 rounded-full"></div>

            {% if current_user.is_authenticated %}
            <div class="mt-8">
                <a href="{{ url_for('tambah_dokter') }}" class="inline-flex items-center gap-2 rounded-md bg-green-700 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-green-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                    Tambah Dokter Baru
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Search and Filter Section -->
        <div class="mb-8 bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md border border-gray-200 dark:border-gray-700 reveal">
            <form method="GET" action="{{ url_for('jadwal_dokter') }}" class="space-y-4">
                <!-- Search Box -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cari Dokter</label>
                    <div class="relative">
                        <input type="text" name="search" value="{{ search_query or '' }}" 
                               placeholder="Ketik nama atau spesialisasi dokter..." 
                               class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white pl-10 pr-4 py-2.5 focus:ring-green-500 focus:border-green-500">
                        <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>

                <!-- Search Type Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Cari Berdasarkan</label>
                    <div class="flex flex-wrap gap-2">
                        <a href="{{ url_for('jadwal_dokter', search_type='nama', search=search_query or '', sort_by=sort_by) }}" 
                           class="px-4 py-2 rounded-full text-sm font-medium transition {% if search_type == 'nama' %}bg-green-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}">
                            Nama Dokter
                        </a>
                    </div>
                </div>

                <!-- Specialization Category Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Filter Spesialisasi</label>
                    <div class="flex flex-wrap gap-2">
                        <a href="{{ url_for('jadwal_dokter', search=search_query or '', search_type=search_type) }}" 
                           class="px-4 py-2 rounded-full text-sm font-medium transition {% if not spesialis_filter %}bg-green-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}">
                            Semua
                        </a>
                        {% for spec in specializations %}
                        <a href="{{ url_for('jadwal_dokter', spesialis=spec, search=search_query or '', search_type=search_type) }}" 
                           class="px-4 py-2 rounded-full text-sm font-medium transition {% if spesialis_filter == spec %}bg-green-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}">
                            {{ spec }}
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <div class="flex gap-2">
                    <button type="submit" class="px-6 py-2 bg-green-700 text-white rounded-lg font-semibold hover:bg-green-800 transition">
                        Cari
                    </button>
                    {% if search_query or search_type != 'nama' or spesialis_filter %}
                    <a href="{{ url_for('jadwal_dokter') }}" class="px-6 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition">
                        Reset
                    </a>
                    {% endif %}
                </div>
            </form>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for dr in dokter %}
            <div class="group relative rounded-2xl bg-white dark:bg-gray-800 p-6 border border-gray-200 dark:border-gray-700 hover:border-green-500 dark:hover:border-green-500 shadow-lg hover:shadow-xl transition-all duration-300 reveal text-center flex flex-col items-center">
                
                {% if current_user.is_authenticated %}
                <!-- Delete Button (X) at top right -->
                <button onclick="confirmDelete({{ dr.id }}, '{{ dr.nama }}')" class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center rounded-full bg-red-600 text-white hover:bg-red-700 transition shadow-md z-10">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                {% endif %}

                <div class="aspect-square w-28 h-28 mb-4 overflow-hidden rounded-full border-4 border-green-100 dark:border-green-900 group-hover:border-green-500 transition shadow-md">
                    {% if dr.foto %}
                        {% if dr.foto.startswith('http') %}
                        <img src="{{ dr.foto }}" alt="{{ dr.nama }}" class="h-full w-full object-cover">
                        {% else %}
                        <img src="{{ url_for('static', filename=dr.foto) }}" alt="{{ dr.nama }}" class="h-full w-full object-cover">
                        {% endif %}
                    {% else %}
                    <div class="h-full w-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 text-gray-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg>
                    </div>
                    {% endif %}
                </div>
                <h3 class="text-lg font-bold text-gray-900 dark:text-white group-hover:text-green-600 transition">{{ dr.nama }}</h3>
                <p class="text-sm font-semibold text-green-600 mb-4">{{ dr.spesialis }}</p>
                
                <div class="w-full bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-100 dark:border-gray-700 mb-4">
                    <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2">Jadwal Praktik</p>
                    <div class="space-y-1 whitespace-pre-wrap">
                        <p class="text-sm font-medium text-gray-800 dark:text-gray-200">{{ dr.jadwal }}</p>
                    </div>
                </div>
                
                {% if current_user.is_authenticated %}
                <!-- Edit Button (Green) for Admin -->
                <a href="{{ url_for('edit_dokter', id=dr.id) }}" class="w-full mt-auto rounded-lg bg-green-600 px-4 py-2 text-sm font-bold text-white shadow hover:bg-green-700 transition">
                    Edit Data Dokter
                </a>
                {% else %}
                <!-- Buat Janji Button (Only for Users) -->
                <a href="{{ url_for('buat_janji', dokter_id=dr.id) }}" class="w-full mt-auto rounded-lg bg-green-700 px-4 py-2 text-sm font-bold text-white shadow hover:bg-green-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-green-600 transition">
                    Buat Janji
                </a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
            <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-gray-200 dark:border-gray-700 reveal">
                <!-- Close button -->
                <button onclick="closeDeleteModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                
                <!-- Modal content -->
                <div class="p-8 text-center">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 dark:bg-red-900/30 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8 text-red-600 dark:text-red-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                    </div>
                    
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Konfirmasi Hapus</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                        Apakah anda yakin ingin menghapus data dokter <span id="dokterName" class="font-semibold text-gray-900 dark:text-white"></span>?
                    </p>
                    
                    <div class="flex gap-3">
                        <button onclick="closeDeleteModal()" class="flex-1 rounded-lg bg-gray-200 dark:bg-gray-700 px-4 py-2.5 text-sm font-semibold text-gray-900 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Tidak
                        </button>
                        <button onclick="confirmDeleteAction()" class="flex-1 rounded-lg bg-red-600 px-4 py-2.5 text-sm font-semibold text-white hover:bg-red-700 transition shadow-lg">
                            Ya, Hapus
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let pendingDeleteId = null;

            function confirmDelete(dokterId, dokterNama) {
                pendingDeleteId = dokterId;
                document.getElementById('dokterName').textContent = dokterNama;
                const modal = document.getElementById('deleteModal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeDeleteModal() {
                const modal = document.getElementById('deleteModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                pendingDeleteId = null;
            }

            function confirmDeleteAction() {
                if (pendingDeleteId) {
                    // Create a form dynamically and submit it
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/hapus_dokter/' + pendingDeleteId;
                    document.body.appendChild(form);
                    form.submit();
                }
            }

            // Close modal when clicking outside
            document.getElementById('deleteModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteModal();
                }
            });
        </script>
    </div>
</div>
{% endblock %}